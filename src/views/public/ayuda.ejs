<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centro de Ayuda - Sistema CEO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/styles/ayuda.css">
</head>
<body>
    
    <div class="chat-container">
        <header class="chat-header">
            <img src="/img/logo-sin-fondo.png" alt="Logo" class="logo">
            <div class="header-info">
                <h2>Asistente Virtual CEO</h2>
                <p><i class="fas fa-circle online"></i> En l칤nea</p>
            </div>
        </header>

        <div class="chat-body" id="chat-body">
            </div>

        <footer class="chat-input-area">
            <form id="chat-form">
                <input type="text" id="user-input" placeholder="Escribe tu pregunta aqu칤..." autocomplete="off">
                <button type="submit" id="send-btn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </form>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chatBody = document.getElementById('chat-body');
            const chatForm = document.getElementById('chat-form');
            const userInput = document.getElementById('user-input');
            let currentButtons = null; // Para guardar los botones actuales

            // --- CEREBRO DEL BOT ---
            const botBrain = {
                // Punto de inicio
                'main_menu': {
                    text: "춰Hola! 游녦 Soy el Asistente Virtual CEO. Para ayudarte mejor, dime qu칠 rol tienes o cu치l es tu problema.",
                    buttons: [
                        { text: "Soy Profesor", key: "menu_profesor" },
                        { text: "Soy Secretar칤a", key: "menu_secretaria" },
                        { text: "Soy Director / Admin", key: "menu_director" },
                        { text: "Tengo problemas de acceso", key: "problemas_acceso" }
                    ]
                },
                
                // --- 0. FLUJO DE ACCESO ---
                'problemas_acceso': {
                    text: "Entendido. 쮺u치l es tu problema de acceso?",
                    buttons: [
                        { text: "No puedo iniciar sesi칩n", key: "no_puedo_iniciar" },
                        { text: "Mi panel es incorrecto", key: "rol_incorrecto" },
                        { text: "Volver al men칰", key: "main_menu" }
                    ]
                },
                'no_puedo_iniciar': {
                    text: "Recuerda: <strong>Solo puedes iniciar sesi칩n con tu correo institucional</strong> (`nombre@ceenriquedeosso.edu.ni`). Si usas un Gmail personal, no funcionar치. <br><br>Si est치s seguro de que usas el correo correcto y no funciona, es posible que tu cuenta no est칠 activa.",
                    buttons: [
                        { text: "Contactar a Soporte", key: "contacto" },
                        { text: "Volver al men칰", key: "main_menu" }
                    ]
                },
                'rol_incorrecto': {
                    text: "Esto sucede si tu cuenta tiene un rol equivocado (ej. eres Director pero entras como Profesor). Por favor, contacta a soporte para que corrijan tus permisos.",
                    buttons: [
                        { text: "Contactar a Soporte", key: "contacto" },
                        { text: "Volver al men칰", key: "main_menu" }
                    ]
                },

                // --- 1. FLUJO DE PROFESOR ---
                'menu_profesor': {
                    text: "춰Hola, Profe! 쯉obre qu칠 es tu consulta?",
                    buttons: [
                        { text: "쮻칩nde subo notas?", key: "donde_subo_notas" },
                        { text: "Me faltan alumnos/cursos", key: "faltan_alumnos" },
                        { text: "쮺칩mo imprimo mis notas?", key: "imprimir_profesor" },
                        { text: "Volver al men칰", key: "main_menu" }
                    ]
                },
                'donde_subo_notas': {
                    text: "En tu panel, ve a la pesta침a <strong>'Subir Notas'</strong>. Ver치s tus cursos en paneles desplegables. 츼brelos y podr치s llenar la tabla de criterios.",
                    buttons: [
                        { text: "Gracias", key: "main_menu" },
                        { text: "Volver al men칰 de Profesor", key: "menu_profesor" }
                    ]
                },
                'faltan_alumnos': {
                    text: "Si te faltan alumnos en la lista o no ves tus cursos correctos, es probable que <strong>Secretar칤a</strong> a칰n no haya finalizado la asignaci칩n de cargas acad칠micas. <br><br>Por favor, comun칤cate con Secretar칤a para que revisen tu asignaci칩n.",
                    buttons: [
                        { text: "Entendido", key: "main_menu" },
                        { text: "Volver al men칰 de Profesor", key: "menu_profesor" }
                    ]
                },
                'imprimir_profesor': {
                    text: "Actualmente, la funci칩n de 'Imprimir S치bana de Notas' est치 en desarrollo. Por ahora, puedes usar la funci칩n de impresi칩n de tu navegador (<strong>Ctrl + P</strong>) dentro de la pesta침a 'Subir Notas' para un reporte r치pido.",
                    buttons: [
                        { text: "Entendido", key: "main_menu" },
                        { text: "Volver al men칰 de Profesor", key: "menu_profesor" }
                    ]
                },

                // --- 2. FLUJO DE SECRETAR칈A ---
                'menu_secretaria': {
                    text: "춰Hola! 쯈u칠 gesti칩n de Secretar칤a necesitas realizar?",
                    buttons: [
                        { text: "쮺칩mo inscribo un alumno?", key: "inscribir_alumno" },
                        { text: "쮺칩mo retiro un alumno?", key: "retirar_alumno" },
                        { text: "쮺칩mo creo un profesor?", key: "crear_profesor" },
                        { text: "Volver al men칰", key: "main_menu" }
                    ]
                },
                'inscribir_alumno': {
                    text: "Ve a <strong>'Gesti칩n de Alumnos'</strong> y haz clic en el bot칩n azul <strong>'Nuevo Estudiante'</strong>. Deber치s llenar toda la ficha biogr치fica y acad칠mica, incluyendo el grado y secci칩n al que se inscribe.",
                    buttons: [
                        { text: "Entendido", key: "main_menu" },
                        { text: "Volver al men칰 de Secretar칤a", key: "menu_secretaria" }
                    ]
                },
                'retirar_alumno': {
                    text: "En <strong>'Gesti칩n de Alumnos'</strong>, busca al estudiante en la lista y haz clic en el bot칩n rojo <strong>'Retirar'</strong>. Deber치s escribir un motivo (ej. 'Traslado') para confirmar la baja.",
                    buttons: [
                        { text: "Entendido", key: "main_menu" },
                        { text: "Volver al men칰 de Secretar칤a", key: "menu_secretaria" }
                    ]
                },
                'crear_profesor': {
                    text: "Ve a <strong>'Gesti칩n de Profesores'</strong> y haz clic en <strong>'Nuevo Profesor'</strong>. Llena sus datos biogr치ficos. <br><br><strong>Importante:</strong> El profesor debe iniciar sesi칩n *una vez* (y fallar) para que su correo aparezca en el panel del Director y puedas asignarle el rol.",
                    buttons: [
                        { text: "Entendido", key: "main_menu" },
                        { text: "Volver al men칰 de Secretar칤a", key: "menu_secretaria" }
                    ]
                },

                // --- 3. FLUJO DE DIRECTOR ---
                'menu_director': {
                    text: "춰Hola, Director! 쯈u칠 deseas administrar hoy?",
                    buttons: [
                        { text: "Asignar profesor a clase", key: "asignar_clase" },
                        { text: "Crear/Activar un usuario", key: "crear_usuario" },
                        { text: "Activar A침o Escolar", key: "activar_anio" },
                        { text: "Volver al men칰", key: "main_menu" }
                    ]
                },
                'asignar_clase': {
                    text: "Ve al Panel de Admin y entra a <strong>'Gestionar Cursos'</strong>. Desde ah칤, podr치s seleccionar un profesor, una asignatura, un grado y una secci칩n para crear la asignaci칩n de ese curso.",
                    buttons: [
                        { text: "Entendido", key: "main_menu" },
                        { text: "Volver al men칰 de Director", key: "menu_director" }
                    ]
                },
                'crear_usuario': {
                    text: "Primero, la persona (profesor, secretaria) debe <strong>intentar iniciar sesi칩n con su correo institucional</strong> (`@ceenriquedeosso.edu.ni`). <br><br>Una vez que lo haga, aparecer치 en tu panel de <strong>'Gestionar Usuarios'</strong> con rol 'Pendiente'. Entra ah칤, busca su correo y as칤gnale el rol correcto (ej. 'PROFESORES') y pon su estado en 'Activo'.",
                    buttons: [
                        { text: "Entendido", key: "main_menu" },
                        { text: "Volver al men칰 de Director", key: "menu_director" }
                    ]
                },
                'activar_anio': {
                    text: "En el Panel de Admin, ve a <strong>'A침o Lectivo'</strong>. Crea el nuevo a침o (ej. 2026) y luego haz clic en el bot칩n <strong>'Activar'</strong>. <br><br><strong>춰Cuidado!</strong> Esto cerrar치 el a침o actual y los profesores solo ver치n los cursos y alumnos del nuevo a침o.",
                    buttons: [
                        { text: "Entendido", key: "main_menu" },
                        { text: "Volver al men칰 de Director", key: "menu_director" }
                    ]
                },

                // --- 4. FALLBACK Y CONTACTO ---
                'contacto': {
                    text: "Para soporte t칠cnico, contacta a los administradores: <ul><li><i class='fab fa-whatsapp'></i> <strong>WhatsApp:</strong> <a href='https://wa.me/50577410650' target='_blank'>+505 7741 0650</a></li><li><i class='fas fa-envelope'></i> <strong>Correo:</strong> <a href='mailto:andrea.rivas41i@std.uni.edu.ni'>andrea.rivas41i@std.uni.edu.ni</a></li></ul>",
                    buttons: [
                        { text: "Volver al men칰 principal", key: "main_menu" }
                    ]
                },
                'default': {
                    text: "No entend칤 muy bien esa pregunta. 游땟 Si no ves una opci칩n que te ayude, te recomiendo contactar al soporte.",
                    buttons: [
                        { text: "Ver informaci칩n de contacto", key: "contacto" },
                        { text: "Volver al men칰 principal", key: "main_menu" }
                    ]
                }
            };
            // --- FIN DEL CEREBRO ---


            // Limpia los botones de respuesta r치pida
            function clearButtons() {
                if (currentButtons) {
                    chatBody.removeChild(currentButtons);
                    currentButtons = null;
                }
            }

            // A침ade un mensaje al chat
            function addMessage(message, sender, buttons = []) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                messageDiv.innerHTML = message;
                chatBody.appendChild(messageDiv);

                if (buttons.length > 0) {
                    clearButtons(); 
                    const buttonContainer = document.createElement('div');
                    buttonContainer.className = 'button-container';
                    buttons.forEach(btn => {
                        const button = document.createElement('button');
                        button.className = 'qr-btn';
                        button.textContent = btn.text;
                        button.setAttribute('data-key', btn.key);
                        buttonContainer.appendChild(button);
                    });
                    chatBody.appendChild(buttonContainer);
                    currentButtons = buttonContainer;
                }
                
                chatBody.scrollTop = chatBody.scrollHeight;
            }

            // Muestra el indicador de "escribiendo..."
            function showTypingIndicator() {
                const typingDiv = document.createElement('div');
                typingDiv.className = 'message bot typing-indicator';
                typingDiv.innerHTML = '<span></span><span></span><span></span>';
                chatBody.appendChild(typingDiv);
                chatBody.scrollTop = chatBody.scrollHeight;
                return typingDiv;
            }

            // Procesa la entrada (de texto o de bot칩n)
            function processInput(key, userText) {
                if (userText) {
                    addMessage(userText, 'user');
                }
                
                clearButtons();
                userInput.disabled = true;

                const response = botBrain[key] || botBrain['default'];

                const typingIndicator = showTypingIndicator();
                setTimeout(() => {
                    chatBody.removeChild(typingIndicator);
                    addMessage(response.text, 'bot', response.buttons);
                    userInput.disabled = false;
                    userInput.focus();
                }, 800 + Math.random() * 400);
            }

            // Maneja el clic en los botones de respuesta r치pida
            chatBody.addEventListener('click', (e) => {
                if (e.target.classList.contains('qr-btn')) {
                    const key = e.target.getAttribute('data-key');
                    const text = e.target.textContent;
                    addMessage(text, 'user'); 
                    processInput(key, null); 
                }
            });

            // Maneja el env칤o del formulario de texto
            chatForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const text = userInput.value;
                if (text.trim() === '') return;
                
                const lowerText = text.toLowerCase();
                let key = 'default'; // Por defecto, no entiende

                // Palabras clave para texto libre
                if (lowerText.includes('iniciar') || lowerText.includes('sesi칩n') || lowerText.includes('entrar') || lowerText.includes('acceso')) {
                    key = 'problemas_acceso';
                } else if (lowerText.includes('notas') || lowerText.includes('calificaciones') || lowerText.includes('subir')) {
                    key = 'donde_subo_notas';
                } else if (lowerText.includes('alumno') || lowerText.includes('inscribir') || lowerText.includes('matricular')) {
                    key = 'inscribir_alumno';
                } else if (lowerText.includes('retirar') || lowerText.includes('baja')) {
                    key = 'retirar_alumno';
                } else if (lowerText.includes('nuevo profesor') || lowerText.includes('crear profe')) {
                    key = 'crear_profesor';
                } else if (lowerText.includes('asignar') || lowerText.includes('clase') || lowerText.includes('curso')) {
                    key = 'asignar_clase';
                } else if (lowerText.includes('rol') || lowerText.includes('permisos') || lowerText.includes('usuario')) {
                    key = 'crear_usuario';
                } else if (lowerText.includes('a침o') || lowerText.includes('activar') || lowerText.includes('nuevo a침o')) {
                    key = 'activar_anio';
                } else if (lowerText.includes('ayuda') || lowerText.includes('contacto') || lowerText.includes('soporte') || lowerText.includes('otra')) {
                    key = 'contacto';
                }

                processInput(key, text); // Procesa la clave encontrada
                userInput.value = '';
            });

            // Mensaje de bienvenida inicial
            setTimeout(() => {
                const welcome = botBrain['main_menu'];
                addMessage(welcome.text, 'bot', welcome.buttons);
            }, 500);
        });
    </script>
</body>
</html>