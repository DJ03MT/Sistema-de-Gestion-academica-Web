<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Boletín Académico <%= anio %></title>
    <style>
        @page {
            size: Letter;
            margin: 0.75in;
        }
        body {
            font-family: Arial, sans-serif;
            font-size: 8pt;
            color: #000;
        }
        .header, .info-bar {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            width: 100%;
        }
        .header {
            border-bottom: 2px solid #000;
            padding-bottom: 5px;
        }
        .header-logo { width: 70px; }
        .header-logo img { width: 100%; }
        .header-titulo {
            text-align: center;
            flex-grow: 1;
            padding: 0 10px;
        }
        .header-titulo h1 {
            font-size: 14pt;
            margin: 0;
            font-weight: bold;
        }
        .header-titulo p {
            font-size: 12pt;
            margin: 5px 0 0 0;
            font-weight: bold;
        }
        .header-info-lateral { width: 70px; }
        .info-bar {
            margin-top: 10px;
            font-size: 9pt;
            padding-bottom: 5px;
            border-bottom: 1px solid #ccc;
        }
        .info-bar .info-col {
            width: 33.3%;
        }

        .section-title {
            font-size: 9pt;
            font-weight: bold;
            background-color: #eee;
            padding: 4px;
            margin-top: 10px;
            border: 1px solid #999;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 5px;
        }
        .data-table th, .data-table td {
            border: 1px solid #000;
            padding: 3px 4px;
            text-align: center;
            height: 16px;
        }
        .data-table th {
            font-size: 7.5pt;
            background-color: #f2f2f2;
        }
        .data-table .asignatura {
            text-align: left;
            font-weight: bold;
            width: 30%;
        }
        .data-table .cuant, .data-table .cuali {
            width: 35px;
        }
        .data-table .sem {
            width: 40px;
            background-color: #f2f2f2;
        }

        .valores-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .valores-table th, .valores-table td {
            border: 1px solid #000;
            padding: 3px 4px;
            text-align: left;
            font-size: 7.5pt;
        }
        .valores-table th:first-child { width: 5%; text-align: center; }
        .valores-table th:last-child { width: 10%; text-align: center; }
        .valores-table td:last-child { text-align: center; font-weight: bold; }
        .valores-table .header-row { background-color: #f2f2f2; text-align: center; font-weight: bold; }

        .footer-section {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            gap: 15px;
        }
        .footer-box {
            flex: 1;
            border: 1px solid #000;
        }
        .footer-box .title {
            font-weight: bold;
            text-align: center;
            background-color: #f2f2f2;
            padding: 3px;
            border-bottom: 1px solid #000;
        }
        .footer-box table {
            width: 100%;
            border-collapse: collapse;
        }
        .footer-box table td {
            border: 1px solid #000;
            padding: 3px;
            height: 16px;
            text-align: center;
        }
        .footer-box table td:first-child {
            text-align: left;
            font-weight: bold;
            background-color: #f2f2f2;
        }

        .observaciones {
            border: 1px solid #000;
            height: 60px;
            margin-top: 10px;
            padding: 4px;
            text-align: left;
            vertical-align: top;
        }
        .firmas {
            display: flex;
            justify-content: space-between;
            margin-top: 50px;
        }
        .firma-linea {
            border-top: 1px solid #000;
            width: 200px;
            text-align: center;
            padding-top: 5px;
            font-size: 9pt;
        }

        <%
        // --- Funciones Helper para las notas ---
        function getCualitativa(nota) {
          if (nota === null || nota === undefined) return '';
          const n = Math.round(nota);
          if (n >= 90) return 'AA';
          if (n >= 80) return 'AS';
          if (n >= 70) return 'AE';
          if (n >= 60) return 'AM';
          return 'AI';
        }
        function getCualitativaValores(nota) {
          if (nota === null || nota === undefined) return '';
          const n = Math.round(nota);
          if (n >= 90) return 'E';
          if (n >= 80) return 'MB';
          if (n >= 70) return 'B';
          if (n >= 60) return 'R';
          return 'I';
        }
        function formatNota(nota) {
            if (nota === null || nota === undefined) return '';
            return Math.round(nota);
        }
        %>
    </style>
</head>
<body>
    
    <div class="header">
        <div class="header-logo">
            <img src="http://localhost:3000/img/LogoWE.webp" alt="Logo">
        </div>
        <div class="header-titulo">
            <h1>COLEGIO ENRIQUE DE OSSÓ</h1>
            <p>INFORME ACADÉMICO <%= anio %></p>
        </div>
        <div class="header-info-lateral">
            <img src="http://localhost:3000/img/Logo-CEO.webp" alt="Logo STJ" style="width: 100%; height: auto;">
        </div>
    </div>

    <div class="info-bar">
        <div class="info-col"><strong>Nombres y apellidos:</strong> <%= estudiante.NombreCompleto %></div>
        <div class="info-col"><strong>Grado:</strong> <%= estudiante.NombreGrado %></div>
        <div class="info-col"><strong>Código:</strong> <%= estudiante.CODIGO_ESTUDIANTE %></div>
    </div>

    <% boletinAgrupado.forEach(seccion => { %>
        <% if (seccion.notas.length > 0) { %>
            <div class="section-title"><%= seccion.nombre %></div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th class="asignatura" rowspan="2">Asignatura</th>
                        <th colspan="2">I C</th>
                        <th colspan="2">II C</th>
                        <th class="sem" rowspan="2">I S</th>
                        <th colspan="2">III C</th>
                        <th colspan="2">IV C</th>
                        <th class="sem" rowspan="2">II S</th>
                        <th colspan="2">VF</th>
                    </tr>
                    <tr>
                        <th class="cuant">Cuant.</th>
                        <th class="cuali">Cuali.</th>
                        <th class="cuant">Cuant.</th>
                        <th class="cuali">Cuali.</th>
                        <th class="cuant">Cuant.</th>
                        <th class="cuali">Cuali.</th>
                        <th class="cuant">Cuant.</th>
                        <th class="cuali">Cuali.</th>
                        <th class="cuant">Cuant.</th>
                        <th class="cuali">Cuali.</th>
                    </tr>
                </thead>
                <tbody>
                    <% seccion.notas.forEach(n => { %>
                        <tr>
                            <td class="asignatura"><%= n.NombreAsignatura %></td>
                            <td><%= formatNota(n.Nota_Corte1) %></td>
                            <td><%= getCualitativa(n.Nota_Corte1) %></td>
                            <td><%= formatNota(n.Nota_Corte2) %></td>
                            <td><%= getCualitativa(n.Nota_Corte2) %></td>
                            <td class="sem"><%= formatNota(n.Promedio_Semestral_1) %></td>
                            <td><%= formatNota(n.Nota_Corte3) %></td>
                            <td><%= getCualitativa(n.Nota_Corte3) %></td>
                            <td><%= formatNota(n.Nota_Corte4) %></td>
                            <td><%= getCualitativa(n.Nota_Corte4) %></td>
                            <td class="sem"><%= formatNota(n.Promedio_Semestral_2) %></td>
                            <td><%= formatNota(n.Promedio_Final_Cuantitativo) %></td>
                            <td><%= n.Promedio_Final_Cualitativo %></td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        <% } %>
    <% }); %>

    <div class="section-title">VALORES Y ACTITUDES</div>
    <table class="valores-table">
        <thead>
            <tr class="header-row">
                <th>#</th>
                <th>Indicador</th>
                <th>I C</th>
                <th>II C</th>
                <th>III C</th>
                <th>IV C</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <th>1</th>
                <td>Muestra respeto a todos los miembros de la comunidad que aprende.</td>
                <td><%= getCualitativaValores(promediosValores.v1) %></td>
                <td><%= getCualitativaValores(promediosValores.v2) %></td>
                <td><%= getCualitativaValores(promediosValores.v3) %></td>
                <td><%= getCualitativaValores(promediosValores.v4) %></td>
            </tr>
            <tr>
                <th>2</th>
                <td>Asiste puntualmente al colegio.</td>
                <td></td><td></td><td></td><td></td>
            </tr>
            <tr>
                <th>3</th>
                <td>Contribuye con el cuido del medio ambiente y las instalaciones.</td>
                <td></td><td></td><td></td><td></td>
            </tr>
            <tr>
                <th colspan="2" style="text-align: right; font-weight: bold; background-color: #f2f2f2;">VALORACIÓN PARCIAL</th>
                <td><%= getCualitativaValores(promediosValores.v1) %></td>
                <td><%= getCualitativaValores(promediosValores.v2) %></td>
                <td><%= getCualitativaValores(promediosValores.v3) %></td>
                <td><%= getCualitativaValores(promediosValores.v4) %></td>
            </tr>
        </tbody>
    </table>

    <div class="footer-section">
        <div class="footer-box">
            <div class="title">ESCALA DE VALORACIÓN DE DISCIPLINAS</div>
            <table>
                <tr><td>AA (90-100)</td><td>Aprendizaje Alcanzado</td></tr>
                <tr><td>AS (80-89)</td><td>Aprendizaje Satisfactorio</td></tr>
                <tr><td>AE (70-79)</td><td>Aprendizaje Elemental</td></tr>
                <tr><td>AM (60-69)</td><td>Aprendizaje Mínimo</td></tr>
                <tr><td>AI (&lt;=59)</td><td>Aprendizaje Inicial</td></tr>
            </table>
        </div>
        <div class="footer-box">
            <div class="title">ASISTENCIA</div>
            <table>
                <tr><td>Llegadas tardes</td><td><%= asistencias.Tarde || 0 %></td></tr>
                <tr><td>Ausencias Justificadas</td><td><%= asistencias.Justificada || 0 %></td></tr>
                <tr><td>Ausencias Injustificadas</td><td><%= asistencias.Injustificada || 0 %></td></tr>
                <tr><td colspan="2" style="background: white; height: 38px;"></td></tr>
            </table>
        </div>
        <div class="footer-box">
            <div class="title">VALORES Y ACTITUDES</div>
            <table>
                <tr><td>E</td><td>Excelente</td></tr>
                <tr><td>MB</td><td>Muy Bueno</td></tr>
                <tr><td>B</td><td>Bueno</td></tr>
                <tr><td>R</td><td>Regular</td></tr>
                <tr><td>I</td><td>Insuficiente</td></tr>
            </table>
        </div>
    </div>

    <div class="section-title">OBSERVACIONES</div>
    <div class="observaciones">
        <%= observaciones %>
    </div>

    <div class="firmas">
        <div class="firma-linea">Firma del docente</div>
        <div class="firma-linea">Firma directora general</div>
    </div>

</body>
</html>